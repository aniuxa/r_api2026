# Día 1 — ¿Qué es una API? Tipos, ventajas y fuentes que usaremos

## Propósito del día 1

En este primer día introducimos el concepto de **API**, los tipos más comunes y por qué son útiles para trabajar con datos sociales. Además, dejamos instaladas las fuentes (paquetes) que consultaremos durante el curso y mostramos ejemplos prácticos mínimos (reproducibles y adaptables).

> Nota de autoría y uso: algunas secciones (en particular, el listado de APIs económicas y la lógica de ejemplos) se inspiran en el material didáctico publicado por Jeffry Bonilla (2024) en RPubs.[^bonilla] El encuadre de API REST/RESTful y terminología general se apoya, entre otros, en documentación de AWS.[^aws_api][^aws_rest]

## ¿Qué es una API?

Una **API** (*Application Programming Interface*) es un conjunto de reglas que permite que un software se comunique con otro: define qué se pide, cómo se pide y qué se recibe a cambio.[^aws_api]  
En la práctica, cuando hablamos de **APIs de datos**, nos referimos a servicios que exponen información (por ejemplo, series de tiempo, indicadores o catálogos) para consultarla de manera automatizada desde R u otro lenguaje.

Además de definiciones generales, en este curso usaremos dos guías de referencia:

- Una guía orientada a **datos abiertos** y publicación/reutilización mediante APIs (Iniciativa Aporta / datos.gob.es).[^datosgob]
- Una guía práctica sobre **Web APIs**, URLs, endpoints y métodos HTTP (Caballero, 2022).[^caballero]

### Partes típicas de una consulta (URL)

En el mundo web, una consulta suele expresarse como una **URL** con:

- **Dominio**: dónde vive el servicio (por ejemplo, `api.worldbank.org`).
- **Ruta / endpoint**: qué recurso específico se solicita (por ejemplo, `v2/country/.../indicator/...`).
- **Parámetros**: filtros como periodo, país, indicador, formato de salida (`format=json`, etc.).[^worldbank_api]
- **Encabezados (headers)**: por ejemplo, llaves (*tokens*) para autenticación.[^banxico_token]

Estas piezas (URL + parámetros + headers) son la “gramática” mínima para pedir datos a una API.[^caballero]

## Tipos de API que nos importan en el curso

### Por estilo de diseño: REST/RESTful

Muchas fuentes públicas se consultan vía **APIs RESTful**, un estilo común para intercambiar información en la web.[^aws_rest]  
En REST es frecuente usar métodos HTTP como:

- `GET`: consultar
- `POST`: enviar/crear (menos común en fuentes públicas de datos)

Las respuestas suelen venir en **JSON** (y a veces XML o CSV).[^aws_rest]

### Por acceso: pública, privada, de socios, compuesta

Para fines prácticos, conviene distinguir estas categorías (la frontera puede variar según el proveedor): APIs **públicas**, **privadas**, **de socios** y **compuestas**.[^aws_api]  
Lo relevante en un curso aplicado es **qué exige cada fuente**:

- ¿Requiere registro?
- ¿Pide token/llave?
- ¿Tiene límites de descarga (*rate limits*)?

## Ventajas y desventajas de usar APIs

### Ventajas

- **Reproducibilidad**: el mismo script reproduce la descarga (sin “clics”).[^datosgob]
- **Actualización controlada**: re-ejecutar y obtener datos recientes.
- **Descarga selectiva**: pedir solo un indicador/periodo en lugar de bajar archivos enormes.[^worldbank_api]
- **Trazabilidad**: queda el endpoint y los parámetros usados (útil para documentación metodológica).[^caballero]

### Desventajas / riesgos

- **Límites de uso** (*rate limits*): algunas APIs restringen volumen o frecuencia.[^uncomtrade_api]
- **Cambios**: endpoints o parámetros pueden cambiar con el tiempo.[^aws_rest]
- **Dependencia de conectividad**: sin internet no hay consulta.
- **Autenticación y llaves**: hay que gestionar tokens sin exponerlos en repositorios.[^banxico_token]

## Fuentes confiables que consultaremos y qué aporta cada una

A continuación se listan fuentes y **paquetes** o **métodos** de acceso que usaremos para ellas.

### 1) Banco Mundial (World Development Indicators)

- **Qué aporta**: indicadores socioeconómicos comparables (PIB, pobreza, educación, salud).
- **Cómo acceder**: API del Banco Mundial (consulta directa) o paquetes como `{WDI}`.
- **Documentación**: API (developer overview) y paquete `{WDI}`.[^worldbank_dev][^cran_wdi]

### 2) Naciones Unidas — World Population Prospects 2024 (WPP 2024)

- **Qué aporta**: población, fecundidad, mortalidad, migración (estimaciones y proyecciones).
- **Cómo acceder**: paquete `{wpp2024}` (instalación desde GitHub, según el proyecto) y/o archivos oficiales de WPP 2024.
- **Referencia**: repositorio/paquete y sitio oficial de WPP 2024.[^wpp2024_pkg][^wpp2024_un]

### 3) INEGI (México) — API de Indicadores

- **Qué aporta**: indicadores económicos y sociales de México.
- **Cómo acceder**: API oficial de Indicadores o paquete `{inegiR}`.
- **Documentación**: API INEGI y paquete `{inegiR}`.[^inegi_api][^cran_inegir]

### 4) Banco de México — SIE (Series de tiempo)

- **Qué aporta**: series macroeconómicas (tipo de cambio, tasas, UDIS, etc.).
- **Requisito**: **token** en el header `Bmx-Token`.[^banxico_token]
- **Documentación**: guía oficial del SIE-API y ejemplos de endpoints.[^banxico_api][^banxico_examples]

### 5) CEPALSTAT (CEPAL)

- **Qué aporta**: indicadores regionales para América Latina y el Caribe (CEPAL).
- **Cómo acceder**: portal y descargas (la modalidad exacta depende del conjunto de datos).
- **Referencia**: portal CEPALSTAT.[^cepalstat]

### 6) OCDE, FMI, Eurostat y UN Comtrade

Estas fuentes son especialmente útiles para ejemplos de **datos económicos comparados** y comercio internacional. La selección y el enfoque didáctico de esta sección se inspiran en Bonilla (2024).[^bonilla]

- **OCDE**: API de datos (SDMX / OECD Data API).[^oecd_api]
- **FMI**: API (DataMapper / SDMX).[^imf_api]
- **Eurostat**: web services y soporte vía paquete `{eurostat}`.[^eurostat_ws][^cran_eurostat]
- **UN Comtrade**: API de comercio; puede requerir registro/token y tiene límites por plan.[^uncomtrade_api][^cran_comtradr]

### 7) Datamx.io y portales CKAN

- **Qué aporta**: explorar **catálogos** de datasets y metadatos en portales de datos abiertos.
- **Clave**: muchos portales usan CKAN y se consultan con el **Action API** (por ejemplo `package_search`).[^ckan_api]
- **Referencia**: Datamx (portal) y documentación oficial de CKAN API.[^datamx][^ckan_api]

### 8) Bibliografía y metadatos — Crossref

- **Qué aporta**: DOIs, referencias, autores/as, años, revistas; útil para revisión de literatura y control bibliográfico.
- **Cómo acceder**: API de Crossref vía paquete `{rcrossref}`.
- **Documentación**: paquete `{rcrossref}`.[^cran_rcrossref]

## Ejemplos prácticos mínimos (R)

Estos ejemplos son deliberadamente cortos: muestran el patrón **consultar → recibir JSON → convertir a tabla**.

### A) Patrón general con `{httr2}` + `{jsonlite}` (GET + JSON)

La API del Banco Mundial permite pedir JSON agregando `format=json` en la URL.[^worldbank_api]

```{r}
# Instalar (solo la primera vez):
# install.packages(c("httr2", "jsonlite", "dplyr", "tibble"))

library(httr2)
library(jsonlite)
library(dplyr)
library(tibble)

url <- "https://api.worldbank.org/v2/country/MEX/indicator/SP.POP.TOTL?format=json"

resp <- request(url) |> req_perform()
txt  <- resp_body_string(resp)
json <- fromJSON(txt)

# En esta API, la segunda posición suele traer los datos (la primera trae metadatos)
pop <- as_tibble(json[[2]])

pop |> select(date, value) |> head()
```

Paquetes usados (documentación): `{httr2}`, `{jsonlite}`, `{dplyr}`.[^cran_httr2][^cran_jsonlite][^cran_dplyr]

### B) Banco de México (SIE) — estructura de endpoint (con token)

En el SIE-API de Banxico, el token se envía en el header `Bmx-Token`.[^banxico_token]  
Un patrón de consulta típico para una serie es:

`/series/{idSerie}/datos/{fechaIni}/{fechaFin}`[^banxico_examples]

```{r}
# Ejemplo conceptual: NO pegues tu token en un documento público.
# token <- Sys.getenv("BANXICO_TOKEN")

# url <- "https://www.banxico.org.mx/SieAPIRest/service/v1/series/SF43718/datos/2024-01-01/2024-12-31"
# resp <- httr2::request(url) |>
#   httr2::req_headers(`Bmx-Token` = token) |>
#   httr2::req_perform()
# dat <- jsonlite::fromJSON(httr2::resp_body_string(resp))
```

### C) INEGI — vía paquete (más amigable para docencia)

La API de Indicadores de INEGI requiere una llave (*token*).[^inegi_api]  
El paquete `{inegiR}` facilita la consulta desde R.[^cran_inegir]

```{r}
# install.packages("inegiR")
library(inegiR)

# key <- Sys.getenv("INEGI_KEY")
# x <- Serie_INEGI("496150", token = key)  # Ejemplo ilustrativo: el id se revisa en clase
# head(x)
```

### D) CKAN / Datamx — búsqueda de datasets por palabra clave

En CKAN, `package_search` permite buscar datasets por texto en metadatos.[^ckan_api]

```{r}
# install.packages(c("httr2", "jsonlite"))
library(httr2)
library(jsonlite)

base <- "https://datamx.io/api/3/action/package_search?q=movilidad"
resp <- request(base) |> req_perform()
json <- fromJSON(resp_body_string(resp))

# ¿Qué trae el resultado?
names(json$result)

# Primeros títulos encontrados (si existen):
head(json$result$results$title, 10)
```

## Lecturas y tareas sugeridas para cerrar el día 1

1. Identificar una pregunta de investigación (social/demográfica) y proponer:
   - 1 fuente por API (o paquete)
   - 1 indicador/tabla que sería útil extraer
2. Preparar llaves/tokens (INEGI, Banxico) como **variables de entorno** (sin pegarlas en código).
3. Explorar la web del curso: <https://aniuxa.github.io/r_api2026/>

------------------------------------------------------------------------

## Referencias

[^bonilla]: Bonilla, Jeffry (2024). *Uso de APIs en R para el Acceso a datos económicos: OCDE, FMI, Banco Mundial, UN Comtrade y Eurostat*. RPubs (17 de noviembre de 2024). <https://rpubs.com/JeffryBonilla20/Uso_APIs_R>

[^aws_api]: Amazon Web Services (AWS). *¿Qué es una API?* <https://aws.amazon.com/es/what-is/api/>

[^aws_rest]: Amazon Web Services (AWS). *¿Qué es una API RESTful?* <https://aws.amazon.com/es/what-is/restful-api/>

[^datosgob]: Iniciativa Aporta (datos.gob.es), Ministerio para la Transformación Digital y de la Función Pública (España) / Entidad Pública Empresarial Red.es (2025). *Guía práctica para la publicación de Datos Abiertos usando APIs* (05/02/2025). <https://datos.gob.es/sites/default/files/doc/file/guia_publicacion_apis.pdf>

[^caballero]: Caballero, Alberto Ramírez (2022). *Guía para aprender a trabajar con APIS (versión 1).* <https://cosasdedevs.com/static/dist/files/guia-para-aprender-a-trabajar-con-apis-version-1.pdf>

[^worldbank_dev]: World Bank Data Help Desk. *Developer information overview.* <https://datahelpdesk.worldbank.org/knowledgebase/articles/889392-developer-information-overview>

[^worldbank_api]: World Bank Data Help Desk. *World Bank API — Basic call structure and parameters (incluye uso de `format=json`).* <https://datahelpdesk.worldbank.org/knowledgebase/topics/125589-developer-information>

[^cran_wdi]: CRAN. *Paquete WDI: World Development Indicators.* <https://cran.r-project.org/package=WDI>

[^wpp2024_un]: United Nations, DESA Population Division. *World Population Prospects 2024.* <https://population.un.org/wpp/>

[^wpp2024_pkg]: (Proyecto en R) *wpp2024: acceso a WPP 2024 desde R (repositorio).* <https://github.com/PPgp/wpp2024>

[^inegi_api]: INEGI. *Servicios: API de Indicadores.* <https://www.inegi.org.mx/servicios/api_indicadores.html>

[^cran_inegir]: CRAN. *Paquete inegiR.* <https://cran.r-project.org/package=inegiR>

[^banxico_token]: Banco de México. *SIE API — Token de consulta y autenticación (header `Bmx-Token`).* <https://www.banxico.org.mx/SieAPIRest/service/v1/token>

[^banxico_api]: Banco de México. *SIE API — Documentación.* <https://www.banxico.org.mx/SieAPIRest/service/v1/doc/>

[^banxico_examples]: Banco de México. *SIE API — Ejemplos de consulta.* <https://www.banxico.org.mx/SieAPIRest/service/v1/doc/ejemplos>

[^cepalstat]: CEPAL. *CEPALSTAT — Estadísticas y bases de datos.* <https://statistics.cepal.org/portal/cepalstat/>

[^oecd_api]: OECD. *OECD Data API / SDMX.* <https://data.oecd.org/api/sdmx-json-documentation/>

[^imf_api]: International Monetary Fund (IMF). *DataMapper / SDMX API help.* <https://www.imf.org/external/datamapper/api/help>

[^eurostat_ws]: European Commission (Eurostat). *Web services.* <https://ec.europa.eu/eurostat/web/main/data/web-services>

[^cran_eurostat]: CRAN. *Paquete eurostat.* <https://cran.r-project.org/package=eurostat>

[^uncomtrade_api]: UN Comtrade. *API documentation.* <https://comtradeplus.un.org/Documentation>

[^cran_comtradr]: CRAN. *Paquete comtradr.* <https://cran.r-project.org/package=comtradr>

[^datamx]: Datamx.io. *Portal CKAN de datos abiertos (catálogo).* <https://datamx.io/dataset>

[^ckan_api]: CKAN Documentation. *API guide (Action API, `package_search`).* <https://docs.ckan.org/en/latest/api/index.html>

[^cran_rcrossref]: CRAN. *Paquete rcrossref.* <https://cran.r-project.org/package=rcrossref>

[^cran_httr2]: CRAN. *Paquete httr2.* <https://cran.r-project.org/package=httr2>

[^cran_jsonlite]: CRAN. *Paquete jsonlite.* <https://cran.r-project.org/package=jsonlite>

[^cran_dplyr]: CRAN. *Paquete dplyr.* <https://cran.r-project.org/package=dplyr>